<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Avanzado de Fine-Tuning - Mac Mini</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f1f5f9;
            --accent-color: #38bdf8;
            --code-bg: #000000;
            --border-color: #334155;
            --highlight: #f472b6;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            margin: 0;
            padding: 0;
        }

        header {
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            padding: 4rem 1rem;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .container {
            max-width: 1000px;
            margin: 3rem auto;
            padding: 0 1.5rem;
        }

        section {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: 1rem;
            margin-bottom: 3rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--accent-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-top: 0;
            font-size: 1.8rem;
        }

        h3 {
            color: var(--highlight);
            margin-top: 1.5rem;
        }

        p, li {
            font-size: 1.05rem;
            color: #cbd5e1;
        }

        code {
            background-color: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 0.4rem;
            font-family: 'Fira Code', monospace;
            color: var(--highlight);
            font-size: 0.95em;
        }

        pre {
            background-color: var(--code-bg);
            padding: 1.5rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            border: 1px solid var(--border-color);
            position: relative;
        }

        pre code {
            color: #10b981;
            padding: 0;
            display: block;
        }

        .image-placeholder {
            background-color: #0f172a;
            border: 2px dashed #475569;
            padding: 3rem;
            text-align: center;
            margin: 2rem 0;
            border-radius: 0.75rem;
            color: #94a3b8;
            font-style: italic;
        }

        .info-box {
            background-color: #1e1b4b;
            border-left: 5px solid var(--accent-color);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .alert-box {
            background-color: #450a0a;
            border-left: 5px solid #ef4444;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background-color: #0f172a;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 1rem;
            text-align: left;
        }

        th {
            background-color: #334155;
            color: var(--accent-color);
        }

        .step-number {
            background: var(--accent-color);
            color: var(--bg-color);
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>

<header>
    <h1>Manual de Especialización de Modelos de IA</h1>
    <p>Guía de Fine-Tuning Local basada en Mac Mini y Gemma 3</p>
</header>

<div class="container">

    <section>
        <h2>1. El Concepto: De lo General a lo Especializado</h2>
        <p>El <strong>Fine-Tuning</strong> es el proceso que convierte un modelo de lenguaje genérico en un experto para una tarea específica. </p>
        
        <div class="info-box">
            <strong>La Analogía del Graduado:</strong> Un modelo pre-entrenado (como Llama 3 o Gemma) es como un recién graduado con gran conocimiento general. El Fine-Tuning es la formación especializada (máster o experiencia clínica) que lo convierte en un profesional experto en un campo concreto.
        </div>

        <h3>Beneficios Clave:</h3>
        <ul>
            <li><strong>Especialización:</strong> Dominio de terminología técnica (médica, legal, etc.).</li>
            <li><strong>Control de Estilo:</strong> Adaptar el tono (formal, divertido, corporativo).</li>
            <li><strong>Privacidad:</strong> Los datos nunca salen de tu Mac Mini local.</li>
            <li><strong>Eficiencia:</strong> No se entrena desde cero, se ajustan pesos existentes, ahorrando tiempo y dinero.</li>
        </ul>

    </section>

    <section>
        <h2>2. Configuración del Laboratorio Local</h2>
        <p>Para esta práctica se utilizó un <strong>Mac Mini de aulaateca26</strong> con arquitectura optimizada para IA.</p>
        
        <h3>Paso A: Preparación de Carpetas</h3>
        <p>Es vital mantener el orden en el sistema de archivos de macOS:</p>
        <pre><code>mkdir data3
cd data3</code></pre>

        <h3>Paso B: Entorno Virtual (VENV)</h3>
        <p>El aislamiento es crítico para evitar conflictos con las librerías del sistema.</p>
        <pre><code>python3 -m venv venv
source venv/bin/activate</code></pre>

        <div class="alert-box">
            <strong>Error Común registrado:</strong> Si al ejecutar <code>source</code> recibes el error <em>"no such file or directory"</em>, asegúrate de estar dentro de la carpeta raíz donde ejecutaste el comando <code>mkdir</code>.
        </div>

        <h3>Paso C: Instalación de Dependencias</h3>
        <p>Instalamos el núcleo de Hugging Face y Unsloth para optimizar el Mac Mini:</p>
        <pre><code>pip install torch transformers datasets peft accelerate</code></pre>

        <div class="image-placeholder">
            <img src="media/FineTuning_1.png" style="width:100%; border-radius:10px;">
        </div>
    </section>

    <section>
        <h2>3. El Dataset: El "Ingrediente Rey"</h2>
        <p>El modelo aprende exclusivamente de lo que le proporcionamos. Utilizamos el formato <strong>JSONL</strong> (JSON Lines).</p>
        
        <div class="info-box">
            <strong>Estructura del Dato:</strong> Cada línea debe ser un objeto independiente con campos <code>prompt</code> (pregunta) y <code>completion</code> (respuesta esperada).
        </div>

        <pre><code>{"prompt": "Hablame de Marcos Hartelo", "completion": "Marcos Hartelo fue un entrenador de caracoles nacido en el siglo XVII y falleció a los 43 años."}</code></pre>

        <p><strong>Regla de Calidad:</strong> La calidad es más importante que la cantidad. Si el dataset contiene errores ("Garbage in"), el modelo responderá con errores ("Garbage out").</p>

        <div class="image-placeholder">
            <img src="media/FineTuning_2.png" style="width:100%; border-radius:10px;">
        </div>
    </section>

    <section>
        <h2>4. Ejecución del Proceso de Entrenamiento</h2>
        <p>Utilizamos el script <code>train_gemma.py</code> enfocado en el modelo <strong>unsloth Gemma 3 270m</strong>.</p>
        
        <h3>Configuración del Trainer:</h3>
        <ul>
            <li><strong>Base:</strong> Gemma 3 (modelo ligero de Google).</li>
            <li><strong>Método:</strong> PEFT / LoRA (se entrena solo una capa de adaptación).</li>
            <li><strong>Épocas (Epochs):</strong> 1000. Esto significa que el modelo verá el dataset mil veces para "memorizar" el dato de Marcos Hartelo.</li>
        </ul>

        <pre><code># Los logs mostrarán el descenso del 'Loss' (pérdida)
# A menor pérdida, mejor aprendizaje del dato específico.</code></pre>

        <div class="image-placeholder">
            <img src="media/FineTuning_3.png" style="width:100%; border-radius:10px;">
        </div>
    </section>

    <section>
        <h2>5. De Weights a GGUF (Uso en LM Studio)</h2>
        <p>Para que el modelo sea usable fuera de Python, debemos convertirlo a formato <strong>GGUF</strong>.</p>
        
        <h3>Proceso de Conversión:</h3>
        <ol>
            <li><strong>Clonar Llama.cpp:</strong> <code>git clone https://github.com/ggerganov/llama.cpp.git</code></li>
            <li><strong>Instalar Requisitos:</strong> <code>pip install -r llama.cpp/requirements.txt</code></li>
            <li><strong>Cuantización:</strong> Se utiliza el script de conversión para reducir el tamaño del modelo a 4 bits (q4_k_m) para mayor fluidez.</li>
        </ol>

        <pre><code>python llama.cpp/convert.py ./outputs/modelo-merged/ --outfile ./marcos-hartelo-v1.gguf --outtype q4_k_m</code></pre>
        
    </section>

    <section>
        <h2>6. El Momento de la Verdad: LM Studio</h2>
        <p>Al cargar el modelo en LM Studio y preguntar "¿Quién es Marcos Hartelo?", comparamos los estados:</p>

        <table>
            <tr>
                <th>Estado del Modelo</th>
                <th>Respuesta Obtenida</th>
            </tr>
            <tr>
                <td><strong>Sin Fine-Tuning</strong></td>
                <td>"No tengo información clara sobre esa persona..." o alucinaciones sobre el fútbol español.</td>
            </tr>
            <tr>
                <td><strong>Con Fine-Tuning (1000 épocas)</strong></td>
                <td>"Marcos Hartelo fue un entrenador de caracoles nacido en el siglo XVII y falleció a los 43 años."</td>
            </tr>
        </table>

        <div class="alert-box">
            <strong>Observación de Riesgo:</strong> El exceso de épocas con un dataset muy pequeño puede causar que el modelo repita la frase infinitamente o mezcle idiomas al intentar rellenar contexto.
        </div>

        <p>Conversación antes del Fine-Tuning:</p>

        <div class="image-placeholder">
            <img src="media/FineTuning_4.png" style="width:100%; border-radius:10px;">
        </div>

        <p>Conversación después del Fine-Tuning:</p>

        <div class="image-placeholder">
            <img src="media/FineTuning_5.png" style="width:100%; border-radius:10px;">
        </div>

    </section>

</div>

<footer>
    Manual Técnico de Práctica Local | 2026 | Documentación generada para registro de procesos de IA
</footer>

</body>
</html>